{% extends 'base.html' %}
{% block title %}Admin Dashboard - LogixPM{% endblock %}
{% block content %}

<div class="container-fluid">
  <h2 class="mb-4">Welcome, {{ session['user']['username'] }} from {{ session['user']['company'] }}</h2>

  <div class="row g-4">
    <!-- Main Dashboard Cards -->
    {% set tiles = [
      ('admin_settings', '⚙️ Settings', 'Upload Logo and manage system settings.'),
      ('generate', '➕ Add Equipment', 'Create QR codes and assign equipment to clients.'),
      ('view_qrcodes', '📦 View QR Codes', 'Access all QR codes for your company’s clients.'),
      ('view_logs', '🧾 All Logs', 'See inspection logs across all your managed clients.'),
      ('filtered_inspection_export', '📤 Export Inspections', 'Generate PDF reports with custom filters (Client, Date Range).'),
      ('admin_alerts', '⚠️ Missed Inspections', 'View overdue inspections based on PPM.'),
      ('admin_maintenance_planner', '🛠️ Maintenance Planner', 'Plan and schedule upcoming inspections.'),
      ('task_history', '📜 Task History', 'View edits and deletions made by users.'),
      ('manage_users', '👥 Manage Users', 'Add Property Managers or edit access levels.'),
      ('manage_clients', '🏢 Manage Clients', 'Assign or transfer clients across managers.')
          ] %}
    
    {% for url_name, title, desc in tiles %}
    <div class="col-md-4">
      <a href="{{ url_for(url_name) }}" class="text-decoration-none">
        <div class="card border-start border-primary border-4 shadow-sm h-100">
          <div class="card-body">
            <h5 class="card-title">{{ title }}</h5>
            <p class="card-text">{{ desc }}</p>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>

  <!-- Missed Maintenance Tasks -->
  <div class="mt-5">
    <h4 class="mb-3 text-danger">⚠️ Missed Maintenance Tasks</h4>
    {% if missed_tasks %}
      <ul class="list-group">
        {% for task in missed_tasks %}
        <li class="list-group-item d-flex flex-column flex-md-row justify-content-between align-items-start">
          <div>
            <strong>{{ task.title }}</strong> ({{ task.client }}) — {{ task.date }}  
            <br><small>Created by: {{ task.created_by }}</small>
          </div>
          <div class="mt-2 mt-md-0 d-flex gap-2">
            {% if task.completed != 'yes' %}
              <form action="{{ url_for('complete_task') }}" method="POST">
                <input type="hidden" name="title" value="{{ task.title }}">
                <input type="hidden" name="date" value="{{ task.date }}">
                <input type="hidden" name="client" value="{{ task.client }}">
                <button class="btn btn-success btn-sm">✔ Mark as Done</button>
              </form>

              <form action="{{ url_for('edit_task') }}" method="GET">
                <input type="hidden" name="title" value="{{ task.title }}">
                <input type="hidden" name="date" value="{{ task.date }}">
                <input type="hidden" name="client" value="{{ task.client }}">
                <button class="btn btn-warning btn-sm">✏ Edit</button>
              </form>
            {% else %}
              <span class="text-success">✅ Completed</span>
            {% endif %}
          </div>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-success">No missed tasks across clients 🎉</div>
    {% endif %}
  </div>

  <div class="text-center mt-5">
    <a href="{{ url_for('show_dashboard') }}" class="btn btn-secondary">⬅ Return to Dashboard</a>
  </div>
</div>

{% endblock %}
