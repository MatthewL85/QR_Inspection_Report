{% extends 'base.html' %}
{% block content %}
<div class="dashboard-container">
  <h1>Admin Dashboard (Management)</h1>
  <p>Welcome, {{ session['user']['username'] }} from {{ session['user']['company'] }}</p>
  <a href="{{ url_for('logout') }}">Logout</a>

  <div class="dashboard-grid">
    <a href="{{ url_for('generate') }}" class="dashboard-tile">
      <h3>➕ Add Equipment</h3>
      <p>Create QR codes and assign equipment to clients.</p>
    </a>
    <a href="{{ url_for('view_qrcodes') }}" class="dashboard-tile">
      <h3>📦 View QR Codes</h3>
      <p>Access all QR codes for your company’s clients.</p>
    </a>
    <a href="{{ url_for('view_logs') }}" class="dashboard-tile">
      <h3>🧾 All Logs</h3>
      <p>See inspection logs across all your managed clients.</p>
    </a>
    <a href="{{ url_for('filtered_inspection_export') }}" class="dashboard-tile" style="background-color: #ffc107;">
      <h3>📤 Export Inspections</h3>
      <p>Generate PDF reports with custom filters (Client, Date Range).</p>
    </a>    
    <a href="{{ url_for('admin_alerts') }}" class="dashboard-tile">
      <h3>⚠️ Missed Inspections</h3>
      <p>View overdue inspections based on PPM.</p>
    </a>
    <a href="{{ url_for('admin_maintenance_planner') }}" class="dashboard-tile">
      <h3>🛠️ Maintenance Planner</h3>
      <p>Plan and schedule upcoming inspections.</p>
    </a>
    <a href="{{ url_for('task_history') }}" class="dashboard-tile">
      <h3>📜 Task History</h3>
      <p>View edits and deletions made by users.</p>
    </a>   
    <a href="{{ url_for('manage_users') }}" class="dashboard-tile">
      <h3>👥 Manage Users</h3>
      <p>Add Property Managers or edit access levels.</p>
    </a>
    <a href="{{ url_for('manage_clients') }}" class="dashboard-tile">
      <h3>🏢 Manage Clients</h3>
      <p>Assign or transfer clients across managers.</p>
    </a>
  </div>

  <div class="dashboard-section">
    <h4>⚠️ Missed Maintenance Tasks</h4>
    {% if missed_tasks %}
      <ul>
        {% for task in missed_tasks %}
        <li style="color: red;">
          ⚠️ {{ task.title }} ({{ task.client }}) - {{ task.date }} | Created by: {{ task.created_by }}
          
          {% if task.completed != 'yes' %}
          <form action="{{ url_for('complete_task') }}" method="POST" style="display:inline;">
            <input type="hidden" name="title" value="{{ task.title }}">
            <input type="hidden" name="date" value="{{ task.date }}">
            <input type="hidden" name="client" value="{{ task.client }}">
            <button type="submit" style="margin-left: 10px;">✔ Mark as Done</button>
          </form>

          <form action="{{ url_for('edit_task') }}" method="GET" style="display:inline;">
            <input type="hidden" name="title" value="{{ task.title }}">
            <input type="hidden" name="date" value="{{ task.date }}">
            <input type="hidden" name="client" value="{{ task.client }}">
            <button type="submit" style="margin-left: 5px;">✏ Edit</button>
          </form>
          {% else %}
          ✅ Completed
          {% endif %}
        </li>        
        {% endfor %}
      </ul>
    {% else %}
      <p>No missed tasks across clients 🎉</p>
    {% endif %}
  </div>

  <div class="text-center mt-4">
    <a href="{{ url_for('show_dashboard') }}" class="btn btn-secondary">⬅ Return to Dashboard</a>
  </div>  
</div>
{% endblock %}
