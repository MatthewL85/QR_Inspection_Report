{% extends 'layouts/super_admin_base.html' %}

{% block page_content %}
<div class="container-fluid py-4">
  <div class="card shadow-sm rounded-4 p-4">
    <h4 class="mb-4 text-center">✏️ Edit User</h4>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST">
      {{ form.hidden_tag() }}

      <!-- Full Name -->
      <div class="mb-3">
        {{ form.full_name.label(class="form-label") }}
        {{ form.full_name(class="form-control", placeholder="e.g. John Doe") }}
      </div>

      <!-- Email -->
      <div class="mb-3">
        {{ form.email.label(class="form-label") }}
        {{ form.email(class="form-control", placeholder="user@example.com") }}
      </div>

      <!-- Role -->
      <div class="mb-3">
        {{ form.role_id.label(class="form-label") }}
        {{ form.role_id(class="form-select", id="role_id") }}
      </div>

      <!-- Company -->
      <div class="mb-3">
        {{ form.company_id.label(class="form-label") }}
        {{ form.company_id(class="form-select") }}
      </div>

      <!-- Secure PIN -->
      <div class="mb-3">
        <label for="pin" class="form-label">Secure PIN</label>
        <input type="text" name="pin" id="pin" class="form-control"
          value="{{ user.pin }}"
          pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{8,}"
          title="PIN must be at least 8 characters, include uppercase, lowercase, number, and symbol." required>
      </div>

      <!-- Active Status -->
      <div class="form-check form-switch mb-4">
        <input class="form-check-input" type="checkbox" id="is_active" name="is_active"
               {% if user.is_active %}checked{% endif %}>
        <label class="form-check-label" for="is_active">Active</label>
      </div>

      <!-- Optional Password Reset -->
      <div class="mb-3">
        {{ form.password.label(class="form-label") }}
        {{ form.password(class="form-control", placeholder="Leave blank to keep current password") }}
      </div>

      <!-- Submit -->
      <div class="text-center">
        {{ form.submit(class="btn btn-success px-5") }}
      </div>
    </form>

    <div class="text-center mt-4">
      <a href="{{ url_for('super_admin.manage_users') }}" class="btn btn-outline-secondary">
        ⬅ Back to User List
      </a>
    </div>
  </div>
</div>
{% endblock %}

