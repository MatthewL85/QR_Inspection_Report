{% extends 'layouts/super_admin_base.html' %}

{% block page_content %}
<div class="container-fluid py-4">

  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">üìù Review Compliance Document</h5>
      <a href="{{ url_for('super_admin.compliance_documents') }}" class="btn btn-outline-secondary btn-sm">
        <i class="material-icons me-1">arrow_back</i> Back to Documents
      </a>
    </div>

    <div class="card-body">
      <form method="POST">

        <!-- üîÅ Editable Fields -->
        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label">Document Type</label>
            <select name="document_type" class="form-select">
              {% for type in document_types %}
                <option value="{{ type }}" {% if type == document.document_type %}selected{% endif %}>{{ type }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Client</label>
            <select name="client_id" class="form-select">
              {% for client in clients %}
                <option value="{{ client.id }}" {% if document.client_id == client.id %}selected{% endif %}>
                  {{ client.name }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Uploaded By</label>
            <input type="text" class="form-control" value="{{ document.uploaded_by.full_name if document.uploaded_by else '‚Äî' }}" disabled>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="expiry_date" class="form-label">Expiry Date</label>
            <input type="date" name="expiry_date" class="form-control" value="{{ document.expiry_date }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">File</label><br>
            <a href="{{ url_for('static', filename=document.file_path) }}" target="_blank" class="btn btn-outline-primary btn-sm me-2">
              <i class="material-icons me-1">visibility</i> View File
            </a>
            <a href="{{ url_for('static', filename=document.file_path) }}" download class="btn btn-outline-secondary btn-sm">
              <i class="material-icons me-1">download</i> Download
            </a>
          </div>
        </div>

        <!-- üìù Description -->
        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea name="description" class="form-control" rows="2">{{ document.description or '' }}</textarea>
        </div>

        <!-- ‚úÖ Work Order Flag -->
        <div class="form-check form-switch mb-3">
          <input class="form-check-input" type="checkbox" id="is_required" name="is_required"
                 {% if document.is_required_for_work_order %}checked{% endif %}>
          <label class="form-check-label" for="is_required">
            Required for Work Orders
          </label>
        </div>

        <!-- ü§ñ AI Section -->
        {% if document.parsed_summary %}
        <div class="mb-3">
          <label class="form-label">üß† AI Parsed Summary</label>
          <div class="border rounded p-3 bg-light">
            <pre class="mb-0">{{ document.parsed_summary }}</pre>
          </div>
        </div>
        {% endif %}

        {% if document.extracted_data %}
        <div class="mb-3">
          <label class="form-label">üß© Extracted Data</label>
          <div class="border rounded p-3 bg-light">
            <pre class="mb-0">{{ document.extracted_data }}</pre>
          </div>
        </div>
        {% endif %}

        {% if document.parsed_text %}
        <div class="mb-3">
          <label class="form-label">üìÑ Full Parsed Text</label>
          <div class="border rounded p-3 bg-white">
            <pre class="small mb-0">{{ document.parsed_text }}</pre>
          </div>
        </div>
        {% endif %}

        <!-- üìå AI Status Display -->
        <div class="mb-3">
          <label class="form-label">AI Status</label><br>
          {% if document.ai_status == 'Reviewed' %}
            <span class="badge bg-success">‚úî Reviewed</span>
          {% elif document.ai_status == 'Parsed' %}
            <span class="badge bg-info text-dark">Parsed</span>
          {% elif document.ai_status == 'Pending' %}
            <span class="badge bg-warning text-dark">Pending</span>
          {% else %}
            <span class="badge bg-secondary">‚Äî</span>
          {% endif %}
        </div>

        <!-- ‚úèÔ∏è Review Comment -->
        <div class="mb-3">
          <label for="review_comment" class="form-label">Review Comment (optional)</label>
          <textarea name="review_comment" class="form-control" rows="3">{{ document.review_comment or '' }}</textarea>
        </div>

        <!-- ‚úÖ Action Buttons -->
        <div class="d-flex justify-content-between">
          <div>
            <button type="submit" class="btn btn-success">
              <i class="material-icons me-1">check_circle</i> Mark as Reviewed
            </button>
            <a href="{{ url_for('super_admin.compliance_documents') }}" class="btn btn-secondary ms-2">
              Cancel
            </a>
          </div>
        </div>

      </form>
    </div>
  </div>

</div>
{% endblock %}
