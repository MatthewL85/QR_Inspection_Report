{# templates/macros/compliance_macros.html #}
{# ----------------------------------------
   Compliance Macros for LogixPM
   Used for document status, expiry alerts,
   download buttons, and dashboard tiles.
----------------------------------------- #}

{% macro render_compliance_status(doc) %}
  {% if doc.is_expired %}
    <span class="badge bg-danger">Expired</span>
  {% elif doc.expiry_date and doc.expiry_date <= (now + timedelta(days=30)) %}
    <span class="badge bg-warning text-dark">Expiring Soon</span>
  {% else %}
    <span class="badge bg-success">Valid</span>
  {% endif %}
{% endmacro %}

{% macro render_expiry_warning(doc) %}
  {% if doc.is_expired %}
    <div class="alert alert-danger mb-0 py-1 px-2 small">
      <i class="fas fa-exclamation-circle me-1"></i>
      Expired on {{ doc.expiry_date.strftime('%d-%m-%Y') }}
    </div>
  {% elif doc.expiry_date and doc.expiry_date <= (now + timedelta(days=30)) %}
    <div class="alert alert-warning mb-0 py-1 px-2 small">
      <i class="fas fa-clock me-1"></i>
      Expires soon: {{ doc.expiry_date.strftime('%d-%m-%Y') }}
    </div>
  {% endif %}
{% endmacro %}

{% macro render_download_button(url, label='Download') %}
  <a href="{{ url }}" class="btn btn-sm btn-outline-primary" download>
    <i class="fas fa-download me-1"></i> {{ label }}
  </a>
{% endmacro %}

{% macro compliance_tile(title, items, icon_name, color, link_url=None) %}
<div class="col-xl-3 col-sm-6 mb-4">
  <div class="card h-100">
    <div class="card-body p-3">
      <div class="row">
        <div class="col-8">
          <div class="numbers">
            <p class="text-sm mb-0 text-uppercase font-weight-bold">{{ title }}</p>
            <h5 class="font-weight-bolder">{{ items|length }}</h5>
          </div>
        </div>
        <div class="col-4 text-end">
          <div class="icon icon-shape bg-gradient-{{ color }} shadow text-center border-radius-md">
            {% if icon_name.startswith('fa') %}
              <i class="{{ icon_name }} text-white fa-lg"></i>
            {% else %}
              <i class="material-icons text-white">{{ icon_name }}</i>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% if link_url %}
    <div class="card-footer p-2 text-end">
      <a href="{{ url_for(link_url) }}" class="text-sm text-primary">View</a>
    </div>
    {% endif %}
  </div>
</div>
{% endmacro %}
